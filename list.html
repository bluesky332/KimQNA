<!DOCTYPE html>


<HTML>
	<HEAD>
		<!-- Set Head -->
		<TITLE>KIM Q&A BOARD - LIST</TITLE>
 		<LINK rel="stylesheet" type="text/css" href="table.css">
 		<link type="text/css" rel="stylesheet" href="ui/layout-default-latest.css" />
		<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="ui/jquery-ui-1.10.1.custom.js"></script>
		<script type="text/javascript" src="ui/jquery.layout-latest.js"></script>
		<script type="text/javascript" src="js/qnaDB.js"></script>
		<script type="text/javascript" src="js/commentDB.js"></script>
		<style type="text/css">
			html, body {
				background:	#666;
				width:		100%;
				height:		100%;					
				padding:	0;
				margin:		0;
				overflow:	auto; /* when page gets too small */
			}
			#container {
				background:	777;
				padding: 3%;
				/* HEIGHT */
				
				height:		85%;					
				min-height:	300px;
				_height:	300px; /* min-height for IE6 */
				/* WIDTH */
				width:		70%;
				

				_width:		700px; /* min-width for IE6 */
				/* HORIZONTAL CENTERING */
				margin:		0 auto;
			}
	/*
	 *	Container sizing
	 *
	 *	Borders and padding are normally *added* to the width/height of the DIV
	 *	However you can get height:100% AND padding/borders by using a nested layout. 
	 *	The outer-layout is just a single pane: center, which is where you add your vertical padding.
	 *	Inside this is your *real layout*. 
	 */
			#paddingWrapper {
				background:	#999;
				padding:	20px 10px;
				border:		4px solid #BBB;
			}
			.pane {
				display:	none; /* will appear when layout inits */
			}
		</style>
		<!-- <SCRIPT type="text/javaScript" src="DBConn.js"></SCRIPT> -->
	</HEAD>	
	
	<!-- HTML 태그 바디 시작 -->
	<BODY>
		<div id="container">
			<div id="paddingWrapper" class="pane ui-layout-center">
				<!-- center 영역 -->
				<div class="pane ui-layout-center">
					<!-- 게시판 뷰 -->
	    			<TABLE border="1" id="board" style=width:100%>
						<TR align='center'>
							<TH>번호</TH>
							<TH>카테고리</TH>
							<TH>제목</TH>
							<TH>이름</TH>
							<TH>답변개수</TH>
							<TH>작성시간</TH>
							<TH>조회수</TH>
						</TR>
						<!-- 리스트 삽입 -->
					</TABLE>
					<!-- 페이지 뷰 -->
					<TABLE>
						<TR class='pageTable'>
						<!-- 페이지정보 삽입 -->
						</TR>
					</TABLE>
				</div>
				<!-- north 영역 -->
				<div class="pane ui-layout-north">
					
					<!-- <div id='contentControl' style='text-align:center'> -->
						<TABLE style=width:100%>
							<TR id='northView'>
								<TD style=text-align:left>
									<a href="#"><INPUT type="button" value="새글쓰기" onClick='JavaScript:btnWritePage();'></a>
								</TD>
								<TD class=northContent style=text-align:right>
								</TD>	
							</TR>
						</TABLE>
						
					<!-- </div> -->
				</div>
				<!-- south 영역 -->
				<div class="pane ui-layout-south">
					<SELECT name='selectSearch'>
						<OPTION selected value='이름'>이름</OPTION>
						<OPTION value='제목'>제목</OPTION>
						<OPTION value='본문'>본문</OPTION>
					</SELECT>
					<INPUT type='text' name='search'>
					<INPUT type='button' value='검색' onClick='JavaScript:btnSearch();'>
				</div>
				<!-- east 영역 -->
				<div class="pane ui-layout-east">
					<!-- 본문을 출력할 DIV -->
					<div id='popUpContent'>
					</div>
					<!-- 새글쓰기를 출력할 FORM -->
					<FORM id='newWrite' name="formWrite">
						<TABLE border="1" style=width:100%>
							<TR>
								<TH>이름</TH>
								<TD><INPUT type="text" name="writer" size="15" maxlength="15"></TD>
							</TR>
							<TR>
								<TH>비밀번호</TH>
								<TD><INPUT type="password" name="passwd" size="10" maxlength="10"></TD>
							</TR>
							<TR>
								<TH>카테고리</TH>
								<TD><SELECT name="category">
    								<OPTION selected value="일반문의">일반문의</OPTION>
    								<OPTION value="기술문의">기술문의</OPTION>
    								<OPTION value="AS문의">AS문의</OPTION>
    								<OPTION value="기타">기타</OPTION>
								</SELECT></TD>
							</TR>
							<TR>
								<TH>휴대폰</TH>
								<TD><INPUT type="tel" name="phone1" size="3" maxlength="3">-<INPUT type="tel" name="phone2" size="4" maxlength="4">-<INPUT type="tel" name="phone3" size="4" maxlength="4"></TD>
							</TR>
							<TR>
								<TH>E-Mail</TH>
								<TD><INPUT type="email" name="email" size="30"></TD>
							</TR>
							<TR>
								<TH>제목</TH>
								<TD><INPUT type="text" name="subject" size="30"></TD>
							</TR>
							<TR>
								<TH colspan="2">내용</TH>
							</TR>
								
							<TR>
								<TD colspan="2"><TEXTAREA rows="10" cols="35" name="content" style=width:99%></TEXTAREA></TD>
							</TR>
							<TR>
								<TD colspan="2" style=text-align:center><INPUT type="button" value="작성완료" onClick="btnSubmitWrite();">
								<INPUT type="reset" value="다시작성">
								<INPUT type="button" value="처음으로" onClick="location.href='list.html'"></TD>
							</TR>
						</TABLE>
					</FORM>
				</div>
			</div>
		</div>
	</BODY>
	<!-- HTML BODY 끝 -->
	
	<!-- 자바스크립트 / jQuery 시작 -->
	<SCRIPT type="text/javaScript">
		$(document).ready(function () {
			$('#container').layout();
			$('#paddingWrapper').layout();
			$("#newWrite").hide();
		});
			// 전역변수
			var db = window.openDatabase("myDB", "1.0", "testDB", 1024 * 1024); // 1MB
			var count;
			
			// DB 초기설정
			db.transaction(initDB, errorDB);
			
			// 게시판 리스트 출력
			selectList();



			
			
			//db.transaction(qnaSelectListDB, errorDB);
			// DB 초기설정
			function initDB(tx) {
				// QNA 테이블 생성
        		tx.executeSql("CREATE TABLE IF NOT EXISTS QNA(COUNT INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, WRITER TEXT NOT NULL, PASSWD TEXT NOT NULL, " +
					"PHONE TEXT NOT NULL, EMAIL TEXT NOT NULL, CATEGORY TEXT NOT NULL, SUBJECT TEXT NOT NULL, CONTENT NOT NULL, " +
					"WDATE TEXT NOT NULL, ANSWER INTEGER DEFAULT 0 NOT NULL, HIT INTEGER DEFAULT 0 NOT NULL)");
				// COMMENT 테이블 생성
	        	tx.executeSql("CREATE TABLE IF NOT EXISTS COMMENT(COUNT INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, QNACNT INTEGER NOT NULL," +
	        		"WRITER TEXT NOT NULL, PASSWD TEXT NOT NULL, CONTENT NOT NULL, WDATE TEXT NOT NULL)");
			}
			// DB 연결중 문제가 생겼을 때
			function errorDB(err) {
	        	console.log("Error processing SQL: "+err.code);
	    	}
			


 			

			

			

			



			

			
			

			

			

			
 			
			
 			
			////////////////////////////////////////////////////////////
			// 여기부터 일반 함수
			////////////////////////////////////////////////////////////
			// [새글쓰기]로 이로
			function btnWritePage(){
				$("#popUpContent").empty();
				$('.northContent').empty();
				$("#newWrite").show();
			}

			// 새글쓰기 폼에서 [작성완료]버튼 클릭시
 			function btnSubmitWrite(){
				var form = document.formWrite;
				var writer = form.writer.value;
 				var passwd = form.passwd.value;
				var category = form.category.value;
				var phone = form.phone1.value + form.phone2.value + form.phone3.value;
				var email = form.email.value;
				var subject = form.subject.value;
				var content = form.content.value;
				form.writer.value = "";
				form.passwd.value = "";
				form.category.value = "";
				form.phone1.value = "";
				form.phone2.value = "";
				form.phone3.value = "";
				form.email.value = "";
				form.subject.value = "";
				form.content.value = "";
				insertData(writer, passwd, phone, email, category, subject, content);
				// 글쓰기창 제거
				$("#newWrite").hide();
				// 리스트 새로고침
				$(".list").remove();
				selectList();
 			}
			
			// 페이지 클릭에 대한 이벤트 처리
 			function pageListener(){
 	 			$(".pageNum").click(function(e) {
 	 				// 클릭한 현재 페이지의 페이지번호만 추출
 	 				var str = $(this).text();
					var curPage = str.replace(/[^0-9]/g, "");
					var perPage = 5;
					// 시작하는 글번호 판단
					var start = (curPage-1) * perPage;
					// 페이지에 효과주기. 현재 페이지만 굵게 표기
					$(this).parent().children().css({"color": "black", "font-weight": "normal"});
					$(this).css({"color": "red", "font-weight": "bold"});
					// 리스트와 본문이 있다면 제거
	 				$('#popUpContent').empty();
					$('.northContent').empty();
					$('.list').remove();
					// 해당 페이지의 테이블을 가져오는 쿼리
					qnaSelectListDB(start, perPage);
	 			});
 			}
			
			// [검색]버튼 클릭시
			function btnSearch(){
				var search = document.all.search.value;
				var type = document.all.selectSearch.value;
				if(type == "이름"){
					type = "WRITER";
				}else if(type == "제목"){
					type = "SUBJECT";
				}else if(type == "본문"){
					type = "CONTENT";
				}
 				$('#popUpContent').empty();
				$('.list').remove();
				$('.pageTable').empty();
				selectSearchDB(type, search);
			}
			
 			// 리스트 클릭에 대한 이벤트 처리
 			function contentListener(){
 	 			$(".list").click(function(e) {
 	 				count = parseInt($(this).text());
 	 				//$("#content").remove();
 	 				var left = 650;
 	 				var top = 100;
 	 				// 선택한 글의 조회수를 증가
 	 				//qnaHitUpdateDB(count);
 	 				// 선택한 글의 본문을 출력
 	 				qnaSelectContentDB(count);
/* 	 				$('#popUpContent').css({
	 					"top": 0,
	 					"left": 0,
						"position": "absolute",
						"background-color":"#f0f8ff"
	 				}).show(); */
	 				//$('#popUpContent').show();
	 				$('#popUpContent').show();
	 				//$('#popUpContent').fadeIn();
	 				//$('#popUpContent').fadeIn();
	 				/* css({
 	 				     "top": top
 	 				     ,"left": left
 	 				     ,"right":650
 	 				     , "position": "absolute"
 	 				     , "background-color":"#f0f8ff"
 	 				 }).show(); */
	 			});
 			}
	 		
 			// 본문의 [수정], [삭제]시 비밀번호 체크
	 		function btnContentCheck(option){
	 			var passwd = prompt("비밀번호를 입력하세요.");
	 			// 옵션에 따라 다른 함수를 호출
 	 			if(option == 'delete'){
 	 				qnaDeleteDB(count, passwd);
	 			}else if(option == 'modify'){
	 				qnaModifyDB(count, passwd);
	 			}
	 		}
	 		
 			// 본문의 [수정완료] 버튼 클릭시 - 본문 UPDATE
	 		function btnModifySubmit(){
 	 			var writer = $(".contentWriter").val();
	 			var passwd = $(".contentPasswd").val();
	 			var phone = $(".contentPhone1").val() + $(".contentPhone2").val() + $(".contentPhone3").val();
	 			var email = $(".contentEmail").val();
	 			var category = $(".contentCategory").val();
	 			var subject = $(".contentSubject").val();
	 			var content = $(".contentContent").val();
	 			// 업데이트 쿼리 실행
	 			qnaUpdateContentDB(count, writer, passwd, phone, email, category, subject, content);
	 			alert('본문 수정이 완료되었습니다.');
	 			qnaSelectContentDB(count);
	 		}
 			
 			
 			// 리플의 [작성] 버튼 클릭시
	 		function btnWriteComment(count){
	 			var writer = $(".commentWriter").val();
		    	var passwd = $(".commentPasswd").val();
		    	var content = $(".commentContent").val();
		    	// 인서트 쿼리 실행
	 			commentInsertDB(count, writer, passwd, content);
		    	// 본문 새로고침
 				qnaSelectContentDB(count);
	 		}
 			
			// 리플의 [수정], [삭제]에 대한 이벤트 처리
			function replyCheckListener(){
	 	 		$(".commentModify").click(function(e) {
	 	 			$(this).attr("disabled", "true");
	 	 			// 게시글의 카운트
	 	 			var qnacnt = count;
	 	 			// 리플의 카운트
	 	 			var cnt = $(this).next().next().next().val();
	 	 			var passwd = prompt("비밀번호를 입력하세요.");
	 	 			// 클릭지점의 위치값정보
	 	 			var curTd = $(this).parent();
	 	 			// 리플수정에 대한 쿼리 및 로직
	 	 			commentModifyDB(qnacnt, cnt, passwd, curTd);
		 		});
		 	 	$(".commentDelete").click(function(e) {
		 	 		$(this).attr("disabled", "true");
	 	 			var qnacnt = count;
	 	 			var cnt = $(this).next().val();
	 		 		var passwd = prompt("비밀번호를 입력하세요.");
	 		 		// 리플 삭제에 대한 쿼리 및 로직
	 	 			commentDeleteDB(qnacnt, cnt, passwd);
		 		});
			 }
			 
			// 리플의 수정모드에서 [수정완료], [수정취소]에 대한 이벤트 처리
			function replyModifyListener(){
		 	 	$(".commentModifyCancel").click(function(e) {
		 	 		$(this).attr("disabled", "true");
		 	 		var qnacnt = count;
		 	 		// 취소시 안내메시지 출력 후 동일 게시글 새로고침
		 			alert('리플 수정이 취소되었습니다.');
		 			qnaSelectContentDB(qnacnt);
		 		});
		 	 	$(".commentModifyOK").click(function(e) {
		 	 		$(this).attr("disabled", "true");
		 	 		var qnacnt = count;
		 	 		var cnt = $(this).next().val();
					var content = $(this).parent().parent().children('td.commentContentForm').children('textarea').val();
					// DB를 수정된 내용으로 업데이트
		 			commentUpdateDB(qnacnt, cnt, content);
					// 안내 메시지 출력 후 게시글 새로고침
		 			alert('리플 수정이 완료되었습니다.');
		 			qnaSelectContentDB(qnacnt);
		 		});
			 }
			

 			
 			
			////////////////////////////////////////////////////////////
			// 끝
			////////////////////////////////////////////////////////////
 			
 			
 			
 			
 			
 			
 			
 			
 			
 			
 			
			
			
			
						// 게시글을 클릭했을때 조회수를 증가
 			//function qnaHitUpdateDB(count){
			//	db.transaction(function(tx){
			//		tx.executeSql("UPDATE QNA SET HIT = HIT + 1 WHERE COUNT = ?", [count]);
			//	});
			//}
			
			
			
			
			
			
 			
 			
 			
 			
 			
 			
 			
 			
 			
 			
 			
 			
 			
 			

			//function listView(length){
			// 클릭시 본문 펼침
 	 			//$(".list").click(function(e) {
 	 				//count = parseInt($(this).text());
 	 				//$("#content").remove();
 	 				//qnaSelectContentDB(count);
 	 				//commentSelectDB(count);
 	 				//db.transaction(commentSelectDB, errorDB);	
 	 				// var divTop = e.clientY + 10; //상단 좌표
 	 				 //var divLeft = e.clientX + 10; //좌측 좌표
		 
 	 				 
 	 				//var $layerPopupObj = $('#popup');
 	 				//var left = ( $(window).scrollLeft() + ($(window).width() - $("popUpContent").width()) / 2 );
 	 				//var top = ( $(window).scrollTop() + ($(window).height() - $("popUpContent").height()) / 2 );
 	 				//$layerPopupObj.css({'left':left,'top':top, 'position':'absolute'});
 	 				//var left = 650;
 	 				//var top = 100;
	 
 	 				 
/*  	 				 $('#popUpContent').css({
 	 				     "top": top
 	 				     ,"left": left
 	 				     ,"right":650
 	 				     , "position": "absolute"
 	 				     , "background-color":"#f0f8ff"
 	 				 }).show(); */
 	 				
 	 				//$("#ddd1").empty();
 	 				/* count = parseInt($(this).text());
 	 				if(count !== "NaN"){
 	 				$("#td" + count).empty();
 	 				$("#td" + count).empty();
 	 				qnaSelectContentDB(count);

 	 				}
 */
 	 				
 	 				// 선택한 인덱스를 가져오는 방법
 	 				//alert(parseInt($(this).text()));
 	 				
 					//if($(this).next().is(":hidden")){ // 게시글 열기
	 				//	for(var i=0;i<length;i++){
  					//		$("#content" + (i+1)).fadeOut();
  					//	}


  					//	$(this).next().fadeIn();
						//document.getElementById('content1').innerHTML += "여긴어디";  

  					//	db.transaction(commentSelectDB, errorDB);	
		  			//}else if($(this).next().is(":visible")){ // 게시글 닫기
  					//	$(this).next().fadeOut();
  					//}
	 			//}); // END			
			//}
 			
 			
 			
 			
 			
		</SCRIPT>
</HTML>
