<!DOCTYPE html>


<HTML>
	<HEAD>
		<!-- Set Head -->
		<TITLE>KIM Q&A BOARD - LIST</TITLE>
 		<LINK rel="stylesheet" type="text/css" href="style.css">
		<SCRIPT type="text/javaScript" src="jquery-1.9.1.min.js"></SCRIPT>
		<!-- <SCRIPT type="text/javaScript" src="DBConn.js"></SCRIPT> -->
	</HEAD>	
	
	<BODY>
		<!-- Load DB -->
		<P></P>
	    <!-- Insert DB -->
	    <P><BR><BR><INPUT type="button" value="새글쓰기" onClick="JavaScript:location.href='write.html'"><BR><BR>
	    </P>
	    <!-- <div id="test">음...</div> -->
	    <div>
			<TABLE border="1" id="board">
				<TR align='center'>
					<TH>번호</TH>
					<TH>카테고리</TH>
					<TH>제목</TH>
					<TH>이름</TH>
					<TH>답변개수</TH>
					<TH>작성시간</TH>
					<TH>조회수</TH>
				</TR>
				<!-- 테스트용 하드 코딩 -->
<!--  				<TR id="list1"><TD>번호1</TD><TD>카테고리1</TD><TD>제목1</TD><TD>이름1</TD><TD>답변개수1</TD><TD>작성시간1</TD><TD>조회수1</TD></TR>
				<TR><TD colspan="7">
				<DIV id="content1"><TABLE>
				<TR><TD>여기가 바로 본문내용1</TD></TR>
				</TABLE></DIV>
				<TR class='list2'><TD>번호2</TD><TD>카테고리2</TD><TD>제목2</TD><TD>이름2</TD><TD>답변개수2</TD><TD>작성시간2</TD><TD>조회수2</TD></TR>
				<TR><TD colspan='7'>
				<DIV id='content2'><TABLE>
				<TR><TD>여기가 바로 본문내용2</TD></TR>
				</TABLE></DIV> -->			
			</TABLE>
		</div>
		
		<SCRIPT type="text/javaScript">
			var db = window.openDatabase("myDB", "1.0", "testDB", 1024 * 1024); // 1MB
			db.transaction(function(tx){
				tx.executeSql("CREATE TABLE IF NOT EXISTS QNA(COUNT INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, WRITER TEXT NOT NULL, PASSWD TEXT NOT NULL, " +
					"PHONE TEXT NOT NULL, EMAIL TEXT NOT NULL, CATEGORY TEXT NOT NULL, SUBJECT TEXT NOT NULL, CONTENT NOT NULL, " +
					"WDATE TEXT DEFAULT current_timestamp NOT NULL, ANSWER INTEGER DEFAULT 0 NOT NULL, HIT INTEGER DEFAULT 0 NOT NULL)");
			});
			db.transaction(function(tx){
				tx.executeSql("SELECT * FROM QNA",[],
					function(tx,result){            
						for(var i = 0; i < result.rows.length; i++){
							var row = result.rows.item(i);
							document.getElementById('board').innerHTML +=  
								"<TR align='center' id='list" + row['COUNT'] + "'>" +
								"<TD>" + row['COUNT'] + "</TD>" +
								"<TD>" + row['CATEGORY'] + "</TD><TD>" + row['SUBJECT'] + "</TD><TD>" + row['WRITER'] + "</TD>" +
								"<TD>" + row['ANSWER'] + "</TD><TD>" + row['WDATE'] + "</TD><TD>" + row['HIT'] + "</TD></TR>" +
								// 본문 세팅
								"<TR align='center' id=content"+row['COUNT']+"><TD colspan='7'><DIV>"+
								"<TABLE border='1'>" +
								"<TR align='center'><TD>핸드폰</TD><TD>" + row['PHONE'] + "</TD><TD>이메일</TD><TD>" + row['EMAIL'] + "</TD></TR>" +
								"<TR align='center'><TD colspan='4'>제 목</TD></TR>" +
								"<TR align='center'><TD colspan='4'>" + row['SUBJECT'] + "</TD></TR>" +
								"<TR align='center'><TD colspan='4'>내 용</TD></TR>" +
								"<TR align='center'><TD colspan='4'>" + row['CONTENT'] + "</TD></TR>" +
								// 리플 양식 세팅
								"<TR align='center'><TD>이름<BR><INPUT type='text' size='15' maxlength='15'><BR>비밀번호<BR><INPUT type='password' size='10' maxlength='10'></TD><TD colspan='2'><TEXTAREA rows='5' cols='40' name='reply' value='리플을 작성하세요.'></TEXTAREA></TD><TD><INPUT type='button' value='작성'></TD></TR>" +
								"</TABLE></DIV></TD></TR>";
								$("#content" + row['COUNT']).hide();
						}
						listView(result.rows.length);
				});
			});
							
			function listView(count){
				// 클릭시 본문을 보여준다.
	 	 		$("#board>tbody>tr").click(function(e) {
	 				// 선택한 인덱스를 가져오는 방법
		 			//alert(parseInt($(this).text()));
				 	 			
					if($(this).next().is(":hidden")){ // 게시글 열기
						for(var i=0;i<count;i++){
							$("#content" + (i+1)).fadeOut();
						}
						$(this).next().fadeIn();
  					}else if($(this).next().is(":visible")){ // 게시글 닫기
  						$(this).next().fadeOut();
  					}
				});
			} // END

	</SCRIPT>
	</BODY>
	

</HTML>
